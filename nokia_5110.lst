gavrasm Gerd's AVR assembler version 3.4 (C)2014 by DG4FAC
----------------------------------------------------------
Source file: nokia_5110.asm
Hex file:    nokia_5110.hex
Eeprom file: nokia_5110.eep
Compiled:    31.12.2015, 19:28:53
Pass:        2
     1: .DEVICE attiny13
     2: 
     3: .SET USI_WM = 0<<USIWM1 | 1<<USIWM0 ; Three-wire mode
Error ==> .SET USI_WM = 0<<USIWM1 | 1<<USIWM0 ; Three-wire mode
[nokia_5110.asm,3] 007: Undefined constant, variable, label or device (USIWM1)!
Error ==> .SET USI_WM = 0<<USIWM1 | 1<<USIWM0 ; Three-wire mode
[nokia_5110.asm,3] 041: Failed resolving right side of equation in EQU/SET/DEF!
     4: .SET USI_CS = 1<<USICS1 | 0<<USICS0 | 1<<USICLK ; External, positive-edge, USITC strobe
Error ==> .SET USI_CS = 1<<USICS1 | 0<<USICS0 | 1<<USICLK ; External, positive-edge, USITC strobe
[nokia_5110.asm,4] 007: Undefined constant, variable, label or device (USICS1)!
Error ==> .SET USI_CS = 1<<USICS1 | 0<<USICS0 | 1<<USICLK ; External, positive-edge, USITC strobe
[nokia_5110.asm,4] 041: Failed resolving right side of equation in EQU/SET/DEF!
     5: .SET USI_TC = 1<<USITC ; Clock Strobe
Error ==> .SET USI_TC = 1<<USITC ; Clock Strobe
[nokia_5110.asm,5] 007: Undefined constant, variable, label or device (USITC)!
Error ==> .SET USI_TC = 1<<USITC ; Clock Strobe
[nokia_5110.asm,5] 041: Failed resolving right side of equation in EQU/SET/DEF!
     6: .SET USI_CONF = USI_WM | USI_CS | USI_TC
     7: 
     8: .SET NOKIA_RST = PB3 ; Reset (Brown)
     9: .SET NOKIA_CE  = PB4 ; Chip Enable (Red)
    10: .SET NOKIA_DC  = PB0 ; Data/Command (Green)
    11: .SET NOKIA_DIN = PB1 ; Serial Data (Yellow)
    12: .SET NOKIA_CLK = PB2 ; Serial Clock (Orange)
    13: 
    14: .DSEG
    15: .ORG SRAM_START
    16: bitr:	.BYTE 8
    17: 
    18: .CSEG
    19: .ORG 0x0000
    20: 000000   C00E  rjmp	RESET_vect	; Reset vector
    21: 000001   9518  reti		; INT0 vector
    22: 000002   9518  reti		; PCINT0 vector
    23: 000003   9518  reti		; TIMER1_COMPA vector
    24: 000004   9518  reti		; TIMER1_OVF vector
    25: 000005   9518  reti		; TIMER0_OVF vector
    26: 000006   9518  reti		; EE_RDY vector
    27: 000007   9518  reti		; ANA_COMP vector
    28: 000008   9518  reti		; ADC vector
    29: 000009   9518  reti		; TIMER1_COMPB vector
    30: 00000A   9518  reti		; TIMER0_COMPA vector
    31: 00000B   9518  reti		; TIMER0_COMPB vector
    32: 00000C   9518  reti		; WDT vector
    33: 00000D   9518  reti		; USI_START vector
    34: 00000E   9518  reti		; USI_OVF vector
    35: 
    36: RESET_vect:
    37: 00000F   9AC3  sbi	PORTB, NOKIA_RST
    38: 000010   9AC4  sbi	PORTB, NOKIA_CE
    39: 000011   9AC0  sbi	PORTB, NOKIA_DC
    40: 
    41: 000012   9ABB  sbi	DDRB, NOKIA_RST ; Set as output
    42: 000013   9ABC  sbi	DDRB, NOKIA_CE  ; Set as output
    43: 000014   9AB8  sbi	DDRB, NOKIA_DC  ; Set as output
    44: 000015   9AB9  sbi	DDRB, NOKIA_DIN ; Set as output
    45: 000016   9ABA  sbi	DDRB, NOKIA_CLK ; Set as output
    46: 
    47: 000017   9AB3  sbi	PINB, NOKIA_RST
    48: 000018   D069  rcall	delay
    49: 000019   9AB3  sbi	PINB, NOKIA_RST
    50: 
    51: ;rcall	delay
    52: 
    53: 	; Set normal display configuration
    54: 00001A   98C0  cbi	PORTB, NOKIA_DC ; Command Mode
    55: 00001B   E200  ldi	R16, 0x20 ; Function Set (H=0)
    56: 00001C   D055  rcall	spi
    57: 00001D   E008  ldi	R16, 0x08 ; Display Configuration (0x08 + Display Configuration)
    58: 00001E   D053  rcall	spi
    59: 00001F   E009  ldi	R16, 0x09 ; Display Configuration (0x08 + Display Configuration)
    60: 000020   D051  rcall	spi
    61: 
    62: 000021   98C0  cbi	PORTB, NOKIA_DC ; Command Mode
    63: 000022   E201  ldi	R16, 0x21 ; Function Set (H=1)
    64: 000023   D04E  rcall	spi
    65: 000024   EE00  ldi	R16, 0xE0 ; Contrast (0x80 + Vop)
    66: 000025   D04C  rcall	spi
    67: 000026   E007  ldi	R16, 0x07 ; Temperature Coefficient (0x04 + TC)
    68: 000027   D04A  rcall	spi
    69: 000028   E107  ldi	R16, 0x17 ; Bias System (0x10 + BS)
    70: 000029   D048  rcall	spi
    71: 
    72: 00002A   D003  rcall	nokia5110_fill
    73: 00002B   D025  rcall	nokia5110_test
    74: 
    75: 00002C   98C4  cbi	PORTB, NOKIA_CE
    76: 
    77: end:
    78: 00002D   CFFF  rjmp	end
    79: 
    80: nokia5110_fill:
    81: 00002E   930F  push	R16
    82: 	; Fill Memory with Pattern
    83: 00002F   9AC0  sbi	PORTB, NOKIA_DC ; Data Mode
    84: 000030   EF0F  ldi	R16, 0xFF
    85: nokia5110_fill_loop:
    86: 000031   D040  rcall	spi
    87: 000032   950A  dec	R16
    88: 000033   F7E9  brne	nokia5110_fill_loop
    89: 000034   910F  pop	R16
    90: 000035   9508  ret
    91: 
    92: nokia5110_point:
    93: 000036   930F  push	R16
    94: 000037   931F  push	R17
    95: 
    96: 000038   98C0  cbi	PORTB, NOKIA_DC ; Command Mode
    97: 000039   E201  ldi	R16, 0x21 ; Function Set (H=1)
    98: 00003A   D037  rcall	spi
    99: 
   100: 00003B   2D01  mov	R16, R1 ; X Address
   101: 00003C   E810  ldi	R17, 0x80
   102: 00003D   0F01  add	R16, R17
   103: 00003E   D033  rcall	spi
   104: 
   105: 00003F   2D02  mov	R16, R2 ; Y Address
   106: 000040   9506  lsr	R16
   107: 000041   9506  lsr	R16
   108: 000042   9506  lsr	R16
   109: 000043   E410  ldi	R17, 0x40
   110: 000044   0F01  add	R16, R17
   111: 000045   D02C  rcall	spi
   112: 
   113: 	; Which bit to set within byte
   114: 000046   2D12  mov	R17, R2
   115: 000047   7017  andi	R17, 7
   116: 000048   2700  clr	R16
   117: 000049   9408  sec
   118: nokia5110_point_loop:
   119: 00004A   1F00  rol	R16
   120: 00004B   951A  dec	R17
   121: 00004C   F7E9  brne	nokia5110_point_loop
   122: 00004D   D024  rcall	spi
   123: 
   124: 00004E   911F  pop	R17
   125: 00004F   910F  pop	R16
   126: 000050   9508  ret
   127: 
   128: nokia5110_test:
   129: 000051   930F  push	R16
   130: 000052   931F  push	R17
   131: 000053   932F  push	R18
   132: 000054   933F  push	R19
   133: 000055   98C0  cbi	PORTB, NOKIA_DC ; Command Mode
   134: 000056   E201  ldi	R16, 0x21 ; Function Set (H=1)
   135: 000057   D01A  rcall	spi
   136: 	; Test Contrast values
   137: 000058   E71F  ldi	R17, 0x7F
   138: nokia5110_test_contrast:
   139: 000059   E800  ldi	R16, 0x80 ; Contrast Vop
   140: 00005A   0F01  add	R16, R17
   141: 00005B   2F01  mov	R16, R17
   142: 00005C   9500  com	R16
   143: 00005D   D014  rcall	spi ; 0xE0
   144: 		; Test Temperature coefficients
   145: 00005E   E023  ldi	R18, 0x03
   146: 	nokia5110_test_temperature:
   147: 00005F   E004  ldi	R16, 0x04
   148: 000060   0F02  add	R16, R18
   149: 000061   D010  rcall	spi
   150: 			; Test Bias values
   151: 000062   E036  ldi	R19, 0x06
   152: 		nokia5110_test_bias:
   153: 000063   E100  ldi	R16, 0x10
   154: 000064   0F03  add	R16, R19
   155: 000065   D00C  rcall	spi ; 0x17
   156: 000066   D01B  rcall	delay
   157: 000067   953A  dec	R19
   158: 000068   F7D2  brpl	nokia5110_test_bias
   159: 000069   952A  dec	R18
   160: 00006A   F7A2  brpl	nokia5110_test_temperature
   161: 00006B   951A  dec	R17	
   162: 00006C   F762  brpl	nokia5110_test_contrast
   163: 00006D   913F  pop	R19
   164: 00006E   912F  pop	R18
   165: 00006F   911F  pop	R17
   166: 000070   910F  pop	R16
   167: 000071   9508  ret
   168: 
   169: spi:
   170: 000072   930F  push	R16
   171: 000073   931F  push	R17
   172: 000074   932F  push	R18
   173: 000075   98C4  cbi	PORTB, NOKIA_CE
Error ==> 	out	USIDR, R16 ; USI Data Register - send R16
[nokia_5110.asm,174] 007: Undefined constant, variable, label or device (USIDR)!
   174: 000076   B900  out	USIDR, R16 ; USI Data Register - send R16
Error ==> 	sbi	USISR, USIOIF ; Clear the Counter Overflow Interrupt Flag
[nokia_5110.asm,175] 007: Undefined constant, variable, label or device (USISR)!
Error ==> 	sbi	USISR, USIOIF ; Clear the Counter Overflow Interrupt Flag
[nokia_5110.asm,175] 007: Undefined constant, variable, label or device (USIOIF)!
   175: 000077   0000  sbi	USISR, USIOIF ; Clear the Counter Overflow Interrupt Flag
   176: 000078   E011  ldi	R17, USI_CONF
   177: spi_loop:
Error ==> 	out	USICR, R17 ; USI Control Register
[nokia_5110.asm,178] 007: Undefined constant, variable, label or device (USICR)!
   178: 000079   B910  out	USICR, R17 ; USI Control Register
Error ==> 	in	R18, USISR
[nokia_5110.asm,179] 007: Undefined constant, variable, label or device (USISR)!
   179: 00007A   0000  in	R18, USISR
Error ==> 	sbrs	R18, USIOIF
[nokia_5110.asm,180] 007: Undefined constant, variable, label or device (USIOIF)!
   180: 00007B   0000  sbrs	R18, USIOIF
   181: 00007C   CFFC  rjmp	spi_loop
   182: ;	in	R16, USIDR ; Nokia 5110 does not have an output
   183: 00007D   9AC4  sbi	PORTB, NOKIA_CE
   184: 00007E   912F  pop	R18
   185: 00007F   911F  pop	R17
   186: 000080   910F  pop	R16
   187: 000081   9508  ret
   188: 
   189: delay: ; R16*(3+40000) = 0.005 - 1.275 seconds 
   190: 000082   930F  push	R16
   191: 000083   931F  push	R17
   192: 000084   932F  push	R18
   193: 000085   E104  ldi	R16, 20 ; 0.1 seconds
   194: delay_R16:
   195: 000086   E312  ldi     R17, 50 
   196: delay_R17: ; 50(4+796)=40,000 cycles = 0.005 seconds 
   197: 000087   EC27  ldi     R18, 199 
   198: delay_R18: ; 796 cycles = 0.0000995 seconds 
   199: 000088   952A  dec     R18 
   200: 000089   0000  nop 
   201: 00008A   F7E9  brne    delay_R18
   202: 00008B   0000  nop 
   203: 00008C   951A  dec     R17 
   204: 00008D   F7C9  brne    delay_R17
   205: 00008E   0000  nop 
   206: 00008F   950A  dec     R16 
   207: 000090   F7A9  brne    delay_R16
   208: 000091   912F  pop	R18
   209: 000092   911F  pop	R17
   210: 000093   910F  pop	R16
   211: 000094   9508  ret 
Compilation aborted, 12 errors!
